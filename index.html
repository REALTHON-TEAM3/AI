<!DOCTYPE html>
<html>
<body>
<h2>OpenAI Realtime WebRTC Demo</h2>

<div id="output" style="font-size:18px; white-space:pre-line; border:1px solid #aaa; padding:10px; width:500px; height:300px; overflow:auto;">
  <b>[ë¡œê·¸ ì¶œë ¥ ì˜ì—­]</b><br>
</div>

<script>
// ------------------------
// ğŸ”§ ì—¬ê¸°ì— API KEY ë„£ê¸°
// ------------------------
const API_KEY = "YOUR_API_KEY";

// í™”ë©´ì— ë¡œê·¸ ì°ê¸°
function log(msg) {
  document.getElementById("output").innerHTML += msg + "<br>";
  console.log(msg);
}

async function start() {
  log("ğŸš€ ì´ˆê¸°í™” ì‹œì‘...");

  // 1) ë§ˆì´í¬ ê¶Œí•œ ìš”ì²­
  let mic;
  try {
    mic = await navigator.mediaDevices.getUserMedia({ audio: true });
    log("ğŸ¤ ë§ˆì´í¬ í—ˆìš© OK");
  } catch (err) {
    log("âŒ ë§ˆì´í¬ ê¶Œí•œ ì‹¤íŒ¨: " + err);
    return;
  }

  // 2) WebRTC PeerConnection ìƒì„±
  const pc = new RTCPeerConnection();

  // 3) GPTê°€ ë°ì´í„° ì±„ë„ì„ ë§Œë“¤ì–´ ë³´ë‚¼ ë•Œ ê°ì§€
  pc.ondatachannel = (event) => {
    const channel = event.channel;

    log("ğŸ“¡ ë°ì´í„° ì±„ë„ ìƒì„±ë¨: " + channel.label);

    // ğŸ”¥ğŸ”¥ğŸ”¥ GPTê°€ ë³´ë‚´ëŠ” ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶œë ¥
    channel.onmessage = (e) => {
      log("ğŸ”µ ìˆ˜ì‹ : " + e.data);
    };
  };

  // 4) ë¡œì»¬ ë°ì´í„° ì±„ë„ (ì´ë²¤íŠ¸ ì „ì†¡ìš©)
  const sendChannel = pc.createDataChannel("oai-events");

  sendChannel.onopen = () => log("ğŸŸ¢ sendChannel OPEN");
  sendChannel.onclose = () => log("ğŸ”´ sendChannel CLOSED");

  // 5) ë§ˆì´í¬ íŠ¸ë™ì„ WebRTCì— ì¶”ê°€
  mic.getTracks().forEach(t => pc.addTrack(t, mic));
  log("ğŸ™ï¸ ë§ˆì´í¬ íŠ¸ë™ ì¶”ê°€ë¨");

  // 6) Offer ìƒì„±
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);
  log("ğŸ“¨ Offer ìƒì„±ë¨");

  // 7) Offerë¥¼ GPT Realtime APIì— ë³´ë‚´ê¸°
  const answer = await fetch(
    "https://api.openai.com/v1/realtime?model=gpt-4o-realtime-preview",
    {
      method: "POST",
      headers: {
        "Authorization": `Bearer ${API_KEY}`,
        "Content-Type": "application/sdp",
        "OpenAI-Beta": "realtime=v1"
      },
      body: offer.sdp
    }
  ).then(res => res.text());

  log("ğŸ“© Answer ìˆ˜ì‹ ë¨");

  // 8) Answerë¥¼ WebRTCì— ì ìš©
  await pc.setRemoteDescription({ type: "answer", sdp: answer });

  log("ğŸ‰ ì—°ê²° ì„±ê³µ! ì´ì œ ë§í•˜ë©´ ë°”ë¡œ í…ìŠ¤íŠ¸ê°€ ëœ¬ë‹¤.");
}

start();
</script>
</body>
</html>